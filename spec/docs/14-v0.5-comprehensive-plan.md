# Reactive Agents v0.5+ Comprehensive Plan

> **Date:** February 22, 2026
> **Baseline:** v0.4.0 — 15 packages, 442 tests, 4 LLM providers, 5 reasoning strategies
> **Goal:** Close critical market gaps, harden the platform, align spec with implementation, and prepare for v1.0

---

## Current State Assessment

### What We Have (v0.4.0)

| Area | Status | Detail |
|------|--------|--------|
| Core agent system | Complete | EventBus, AgentService, TaskService, ContextWindowManager |
| Execution engine | Complete | 10-phase loop, lifecycle hooks, ReactiveAgentBuilder |
| LLM providers | Complete | Anthropic, OpenAI, Gemini, Ollama + test provider |
| Memory system | Complete | Working/Semantic/Episodic/Procedural, FTS5, sqlite-vec KNN, Zettelkasten |
| Reasoning | Complete | 5 strategies: ReAct, Plan-Execute, ToT, Reflexion, Adaptive |
| Tools | 98% | Registry, sandbox, MCP stdio, Tavily, built-ins. SSE/WebSocket stubs |
| Guardrails | Complete | Injection, PII, toxicity detection |
| Verification | Complete | 5-layer pipeline (semantic entropy, fact decomposition, etc.) |
| Cost | Complete | Complexity routing, budget enforcement, semantic cache |
| Identity | Complete | Certificates, RBAC, audit logging |
| Observability | Complete | Tracing, metrics, structured logging |
| Interaction | Complete | 5 autonomy modes, checkpoints, collaboration, preferences |
| Orchestration | Complete | Workflow engine, event sourcing, worker pool |
| Prompts | Complete | Template engine, 24 built-in templates |
| Eval | Complete | LLM-as-judge, 5 dimensions, EvalStore persistence |
| CLI (`rax`) | Complete | init, create, run, eval, dev, playground, inspect |
| Docs | Complete | 26-page Starlight site |
| Tests | Complete | 442 tests across 77 files |

### What We're Missing

| Gap | Priority | Roadmap Phase | Market Pressure |
|-----|----------|---------------|-----------------|
| A2A Protocol (agent-to-agent interop) | CRITICAL | Phase 2 (overdue) | Google/AWS native, 21.9K stars, Linux Foundation |
| Agent-as-Tool pattern | HIGH | Phase 2 | OpenAI & Strands ship this |
| MCP SSE/WebSocket transports | HIGH | Phase 2 | Remote MCP servers need it |
| Spec-implementation misalignments | HIGH | Housekeeping | Internal consistency |
| Test coverage gaps (5 packages thin) | MEDIUM | Hardening | Quality bar |
| Broader provider support (LiteLLM) | MEDIUM | Phase 3 | Vercel supports 40+ |
| Voice/realtime agent foundations | MEDIUM | Phase 4 | Strands, OpenAI, Google shipping voice |
| Evolution package scaffolding | LOW | Phase 5 | Unique differentiator, post-v1.0 |

---

## Spec-to-Implementation Inconsistencies

These must be resolved before new feature work to ensure internal consistency.

### S1. Interaction Mode Naming Mismatch
- **Spec** (`layer-10-interaction-revolutionary-design.md`): 6 modes — Autonomous, Supervised, Collaborative, Consultative, Interrogative, Adaptive
- **Implementation**: 5 modes — Autonomous, Batch, Interactive, Supervised, Mixed
- **Action**: Update spec to match implementation (implementation reflects what was actually built and tested). Add note explaining design evolution.

### S2. Gemini Provider Not in LLM Spec
- **Spec** (`01.5-layer-llm-provider.md`): Only covers Anthropic, OpenAI, Ollama
- **Implementation**: Also includes Gemini (`@google/genai`)
- **Action**: Add Gemini section to LLM provider spec

### S3. Roadmap Timeline Drift
- **Spec** (`09-ROADMAP.md`): 12-month plan Q1 2025 → v1.0 Q4 2025
- **Reality**: v0.4.0 shipped Feb 2026, Phase 2 still incomplete
- **Action**: Rewrite roadmap with realistic dates anchored to current state

### S4. Release Schedule Overlap
- **Spec** (`09-ROADMAP.md`): Shows v0.4.0 in both Alpha (actual) and Beta (planned) sections
- **Action**: Consolidate release schedule to reflect actual history + forward plan

### S5. Guardrails Spec vs Implementation
- **Spec** (`11-missing-capabilities-enhancement.md`): Shows PolicyEngine, ContractEnforcer, scope-enforcer, content-filter as separate services
- **Implementation**: Simplified to GuardrailService + 3 detectors (injection, PII, toxicity)
- **Action**: Update spec to reflect shipped architecture. Note PolicyEngine/ContractEnforcer as future enhancements.

### S6. Eval Spec vs Implementation
- **Spec** (`11-missing-capabilities-enhancement.md`): Shows shadow eval, A/B testing, regression alerts, benchmark suites
- **Implementation**: LLM-as-judge with 5 dimensions + EvalStore + dataset service
- **Action**: Update spec. Mark shadow eval / A/B testing as v1.x features.

### S7. PLAN_REVIEW Issues — Status Update Needed
- **Document** (`PLAN_REVIEW.md`): Lists 15 critical issues from Feb 15, 2026
- **Reality**: Issues #1-10 are all resolved. Issues #11-15 remain strategic gaps.
- **Action**: Update PLAN_REVIEW.md with current resolution status

---

## Implementation Plan

### Sprint 0: Housekeeping (1 week)

**Goal:** Align documentation with reality before building new features.

#### 0.1 Update Spec Files
- [ ] Update `layer-10-interaction-revolutionary-design.md` — align mode names to implementation (Autonomous/Batch/Interactive/Supervised/Mixed)
- [ ] Update `01.5-layer-llm-provider.md` — add Gemini provider section
- [ ] Update `11-missing-capabilities-enhancement.md` — mark shipped items, separate future items
- [ ] Update `PLAN_REVIEW.md` — mark resolved issues (#1-#10), update status on #11-#15

#### 0.2 Update Roadmap
- [ ] Rewrite `09-ROADMAP.md` Phase 1-2 as completed history (actual dates, actual deliverables)
- [ ] Rewrite Phase 3-4 with revised scope and realistic dates
- [ ] Update release schedule to consolidate actual + planned

#### 0.3 Fix Known TODOs in Code
- [ ] Audit all `TODO`/`FIXME`/`HACK` comments across codebase — catalog and triage

**Exit criteria:** All spec files accurately describe what's shipped. No misleading planned-vs-actual confusion.

---

### Sprint 1: A2A Protocol — Core (2 weeks)

**Goal:** Enable Reactive Agents to participate in the A2A ecosystem as both server and client.

**Why first:** A2A is the single highest-value gap. It's a Linux Foundation standard with 21.9K GitHub stars. Google ADK, AWS Strands, and Mastra all support it. Without A2A, Reactive Agents cannot interoperate with the emerging multi-agent ecosystem.

#### 1.1 New Package: `@reactive-agents/a2a`

```
packages/a2a/
├── src/
│   ├── index.ts
│   ├── types.ts                    — AgentCard, A2AMessage, A2ATask, A2AError schemas
│   ├── errors.ts                   — A2AError, DiscoveryError, TransportError
│   ├── agent-card.ts               — AgentCard generation from agent config
│   ├── server/
│   │   ├── a2a-server.ts           — JSON-RPC 2.0 HTTP endpoint (Effect HttpServer)
│   │   ├── task-handler.ts         — Map A2A tasks → internal TaskService
│   │   └── streaming.ts            — SSE streaming for task updates
│   ├── client/
│   │   ├── a2a-client.ts           — Consume remote A2A agents
│   │   ├── discovery.ts            — Agent discovery via .well-known/agent.json
│   │   └── capability-matcher.ts   — Match task requirements to agent capabilities
│   ├── a2a-service.ts              — A2AService Context.Tag + Layer
│   └── runtime.ts                  — createA2ALayer factory
├── tests/
│   ├── agent-card.test.ts
│   ├── a2a-server.test.ts
│   ├── a2a-client.test.ts
│   ├── discovery.test.ts
│   └── a2a-service.test.ts
├── package.json
└── tsconfig.json
```

#### 1.2 A2A Protocol Implementation

**Agent Card (`.well-known/agent.json`):**
- Generate from existing `AgentConfig` + `IdentityService` certificate
- Expose: name, description, capabilities (from tool registry), supported protocols
- Include version, provider info, and authentication requirements

**A2A Server:**
- JSON-RPC 2.0 over HTTP (Effect `HttpServer`)
- Endpoints: `tasks/send`, `tasks/get`, `tasks/cancel`, `tasks/sendSubscribe` (SSE)
- Map incoming A2A tasks to internal `TaskService.create()` + `ExecutionEngine.execute()`
- Return structured `A2ATask` responses with artifacts

**A2A Client:**
- Discover remote agents via `.well-known/agent.json` URL
- Send tasks to remote A2A agents
- Subscribe to task updates via SSE
- Capability matching: match task requirements to discovered agent capabilities

#### 1.3 Integration Points

- **Orchestration**: `OrchestrationService` can delegate sub-tasks to remote A2A agents
- **Builder API**: `.withA2A({ port, basePath })` enables A2A server on the agent
- **Runtime**: `createRuntime({ enableA2A: true, a2aPort: 3000 })` wires the layer
- **Identity**: Agent Cards include certificate info from `IdentityService`
- **Tools**: Remote A2A agents discoverable as tools (feeds into Sprint 2)

#### 1.4 Dependencies

- `@reactive-agents/core` (TaskService, AgentService, types)
- `@reactive-agents/tools` (tool registry for capability exposure)
- `@reactive-agents/identity` (optional — certificates for Agent Card)
- Effect `HttpServer` / `HttpClient` (HTTP transport)

**Exit criteria:** An agent can serve an Agent Card, accept A2A tasks over HTTP, and send tasks to remote A2A agents. Integration tests pass with two local agents communicating via A2A.

---

### Sprint 2: Agent-as-Tool + MCP Transports (1.5 weeks)

**Goal:** Enable agents to be composed as tools, and enable remote MCP servers.

#### 2.1 Agent-as-Tool Pattern

**What:** Register an agent (local or remote A2A) as a callable tool in another agent's ToolService.

**Implementation:**
- New file: `packages/tools/src/adapters/agent-tool-adapter.ts`
  - `createAgentTool(agent: AgentConfig): ToolDefinition` — wraps agent.run() as a tool
  - `createRemoteAgentTool(agentCardUrl: string): ToolDefinition` — wraps A2A client call as a tool
- Builder API: `.withAgentTool(name, agentOrUrl)` registers an agent as a tool
- Tool input schema derived from agent's capabilities
- Tool output returns agent's task result as structured data

**Tests:**
- Local agent-as-tool: Agent A calls Agent B as a tool, gets structured result
- Remote agent-as-tool: Agent A calls remote A2A agent as a tool via HTTP
- Recursive composition: Agent A → Agent B → Agent C (depth limit enforced)

#### 2.2 MCP SSE Transport

**What:** Implement the SSE transport stub in `packages/tools/src/mcp/mcp-client.ts`.

**Implementation:**
- Replace `Effect.void` stub at lines 120-125 with real SSE connection
- Use Effect `HttpClient` for SSE stream consumption
- Parse JSON-RPC messages from SSE event stream
- Reconnection logic with exponential backoff
- Keepalive ping handling

**Tests:**
- Connect to SSE MCP server, discover tools, execute tool call
- Reconnection after disconnect
- Error handling for malformed SSE events

#### 2.3 MCP WebSocket Transport

**What:** Implement the WebSocket transport stub in `packages/tools/src/mcp/mcp-client.ts`.

**Implementation:**
- Replace `Effect.void` stub at lines 125-127 with real WebSocket connection
- Bidirectional JSON-RPC messaging over WebSocket
- Connection lifecycle management (open/close/error/reconnect)
- Message correlation (request ID → response matching)

**Tests:**
- Connect to WebSocket MCP server, discover tools, execute tool call
- Bidirectional message flow
- Connection recovery

**Exit criteria:** Agents can use other agents as tools (local and remote). MCP SSE and WebSocket transports are functional and tested.

---

### Sprint 3: Test Coverage Hardening (1 week)

**Goal:** Bring thin test suites up to the standard set by well-tested packages.

Current test coverage gaps:

| Package | Source Files | Test Files | Target |
|---------|-------------|------------|--------|
| verification | 10 | 2 | 5+ test files |
| identity | 8 | 1 | 3+ test files |
| orchestration | 8 | 1 | 3+ test files |
| observability | 9 | 1 | 3+ test files |
| cost | 10 | 3 | 5+ test files |

#### 3.1 Verification Tests
- [ ] `semantic-entropy.test.ts` — entropy calculation, confidence scoring, edge cases
- [ ] `fact-decomposition.test.ts` — claim extraction, verification pipeline
- [ ] `self-consistency.test.ts` — multi-sample agreement, disagreement detection
- [ ] `multi-source.test.ts` — cross-source fact checking (if applicable)
- [ ] `nli.test.ts` — natural language inference checks

#### 3.2 Identity Tests
- [ ] `certificate-auth.test.ts` — certificate creation, validation, expiry, delegation chains
- [ ] `permission-manager.test.ts` — RBAC rules, role assignment, permission checks
- [ ] `audit-logger.test.ts` — audit event recording, querying, tamper detection

#### 3.3 Orchestration Tests
- [ ] `workflow-engine.test.ts` — DAG execution, step ordering, failure handling, retries
- [ ] `event-sourcing.test.ts` — event recording, replay, state reconstruction
- [ ] `worker-pool.test.ts` — pool sizing, task assignment, worker lifecycle

#### 3.4 Observability Tests
- [ ] `tracer.test.ts` — span creation, parent-child relationships, context propagation
- [ ] `metrics-collector.test.ts` — counter increment, histogram recording, gauge set
- [ ] `structured-logger.test.ts` — JSON output, log levels, context enrichment

#### 3.5 Cost Tests
- [ ] `semantic-cache.test.ts` — cache hit/miss, invalidation, embedding similarity
- [ ] `prompt-compressor.test.ts` — compression ratio, semantic preservation

**Exit criteria:** All packages have >= 3 test files. Total test count increases by 100+. No package has less than 30% of its services tested.

---

### Sprint 4: Builder API & DX Enhancements (1 week)

**Goal:** Wire new features into the builder and ensure a cohesive developer experience.

#### 4.1 Builder API Extensions

```typescript
// A2A support
const agent = await ReactiveAgents.create()
  .withName("research-agent")
  .withProvider("anthropic")
  .withA2A({ port: 3000 })              // Enable A2A server
  .withAgentTool("helper", helperAgent)  // Register agent-as-tool
  .withRemoteAgent("analyst", "https://analyst.example.com")  // Remote A2A agent
  .build();
```

- [ ] `.withA2A(config)` — enables A2A server layer
- [ ] `.withAgentTool(name, agent)` — registers local agent as tool
- [ ] `.withRemoteAgent(name, url)` — registers remote A2A agent as tool
- [ ] Update `createRuntime()` to accept `enableA2A`, `a2aConfig` options

#### 4.2 CLI Extensions

- [ ] `rax serve` — start agent as A2A server (new command)
- [ ] `rax discover <url>` — fetch and display remote agent's Agent Card
- [ ] Update `rax run` to support `--a2a` flag for serving while running

#### 4.3 Documentation Updates

- [ ] Add A2A guide to docs site (`guides/a2a-protocol.md`)
- [ ] Add agent-as-tool guide (`guides/agent-composition.md`)
- [ ] Update architecture page with A2A layer
- [ ] Update builder API reference with new methods

**Exit criteria:** All new features accessible via builder API and CLI. Documentation covers all new capabilities.

---

### Sprint 5: Integration Testing & Release Prep (1 week)

**Goal:** End-to-end validation of all new features working together.

#### 5.1 Integration Tests

- [ ] Two agents communicate via A2A protocol (send task, get result)
- [ ] Agent uses remote agent as tool via A2A
- [ ] Agent connects to remote MCP server via SSE
- [ ] Agent connects to remote MCP server via WebSocket
- [ ] Full pipeline: Builder → A2A server → remote agent tool → MCP tool → response
- [ ] Orchestration delegates sub-task to A2A remote agent

#### 5.2 Example Apps

- [ ] `apps/examples/04-a2a-agents.ts` — two agents communicating via A2A
- [ ] `apps/examples/05-agent-composition.ts` — agent-as-tool pattern
- [ ] `apps/examples/06-remote-mcp.ts` — connecting to remote MCP server

#### 5.3 Release Preparation

- [ ] Update CHANGELOG.md with v0.5.0 entries
- [ ] Update package.json versions across all packages
- [ ] Run full test suite (`bun test`) — target 550+ tests passing
- [ ] Run full build (`bun run build`) — all packages compile clean
- [ ] Build docs site (`cd apps/docs && npx astro build`)
- [ ] Update CLAUDE.md with new package in package map
- [ ] Tag release

**Exit criteria:** v0.5.0 released with A2A, agent-as-tool, MCP transports, and hardened test coverage.

---

## Post-v0.5.0 Roadmap (v0.6.0 — v1.0)

### v0.6.0: Provider Expansion & Optimization (2-3 weeks)
- LiteLLM adapter or OpenAI-compatible proxy pattern (40+ provider support)
- Semantic cache integration into execution engine (verify it's wired end-to-end)
- Prompt compression optimizations
- Custom reasoning strategy registration API (user-defined strategies)

### v0.7.0: Advanced Tools & Memory (2-3 weeks)
- Smart tool selection (AI-powered tool choice based on task)
- Tool composition (automatic multi-tool pipelines)
- Graph memory traversal improvements
- Memory compaction tuning (production workloads)

### v0.8.0: Production Hardening (2-3 weeks)
- Circuit breakers with configurable thresholds
- Graceful degradation (fallback model chains, retry with downgrade)
- Rate limiting per provider
- Connection pooling for A2A and MCP
- Health check endpoints

### v0.9.0: Advanced Interaction & DX (2-3 weeks)
- Voice/realtime agent foundations (WebSocket streaming, audio pipeline stubs)
- React hooks package (`@reactive-agents/react`)
- Visual agent state inspector (web UI)
- Time-travel debugging foundations

### v1.0.0: Launch (2 weeks)
- Comprehensive documentation review
- Performance benchmarks published
- Migration guide from v0.x
- Security audit
- npm publish all packages

### v1.1.0+: Evolution (Phase 5)
- `@reactive-agents/evolution` package
- AgentGenome, ExperiencePool, FitnessEvaluator
- Cross-model strategy transfer
- A2A genome sharing
- `rax eval evolve` CLI command

---

## Risk Register

| Risk | Impact | Mitigation |
|------|--------|------------|
| A2A spec still evolving (v0.2) | Protocol changes break our implementation | Pin to specific A2A spec version, adapter pattern for protocol differences |
| Effect HttpServer complexity | A2A server implementation slower than expected | Start with minimal JSON-RPC handler, add features incrementally |
| SSE/WebSocket MCP testing | Hard to test without real remote MCP servers | Mock servers in tests, validate against MCP reference implementation |
| Test coverage sprint velocity | 100+ new tests in 1 week is aggressive | Prioritize high-value tests (service-level), skip trivial getters |
| Scope creep from A2A | A2A touches many layers | Strict scope: v0.5 = core A2A server/client only, advanced features in v0.6+ |

---

## Success Metrics for v0.5.0

| Metric | Target |
|--------|--------|
| Total tests | 550+ (currently 442) |
| New packages | 1 (`@reactive-agents/a2a`) |
| A2A interop | 2 agents communicate bidirectionally |
| MCP transports | 3/3 (stdio + SSE + WebSocket) |
| Agent-as-tool | Local + remote working |
| Spec alignment | 0 known mismatches between spec and implementation |
| Build time | < 30 seconds |
| All tests pass | 100% green |

---

## Dependencies & Build Order

```
Sprint 0 (Housekeeping)
  ↓
Sprint 1 (A2A Core)
  ↓
Sprint 2 (Agent-as-Tool + MCP) ← depends on A2A client for remote agent tools
  ↓
Sprint 3 (Test Hardening) ← can partially parallel with Sprint 2
  ↓
Sprint 4 (Builder/DX) ← depends on Sprint 1 + 2 for new builder methods
  ↓
Sprint 5 (Integration + Release) ← depends on all above
```

**Total estimated duration: 6-7 weeks to v0.5.0**

---

*This is a living document. Update as sprints complete and scope adjusts.*
